{% macro render_gmail_labels_chips(labels_data, title="Gmail Labels") %}
{# 
  Gmail Labels Dark Theme Chips Macro
  Accepts: service://gmail/labels.items data
  Returns: Complete HTML visualization with dark theme chips
#}

{# 1) Process the data #}
{% set all_labels = labels_data | list %}
{% set user_labels = all_labels | selectattr('type','equalto','user') | sort(attribute='name') | list %}
{% set sys_labels = all_labels | selectattr('type','equalto','system') | sort(attribute='name') | list %}

<!-- Gmail Labels Dark Theme Visualization -->
<div style="font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Oxygen,Ubuntu,Cantarell,sans-serif; line-height:1.45; color:#e5e7eb; background:#0b1220;">
  <div style="max-width:1000px; margin:0 auto; padding:20px;">
    
    <h2 style="margin:0 0 12px 0; color:#f1f5f9; font-size:28px; font-weight:800; letter-spacing:-0.02em;">
      {{ title }} ({{ all_labels|length }})
    </h2>
    
    <div style="font-size:14px; color:#94a3b8; margin-bottom:24px;">
      <strong style="color:#cbd5e1;">User Labels:</strong> {{ user_labels|length }}
      &nbsp;‚Ä¢&nbsp;
      <strong style="color:#cbd5e1;">System Labels:</strong> {{ sys_labels|length }}
    </div>

    {# ---- Section: USER LABELS ---- #}
    {% if user_labels %}
      <h3 style="margin:24px 0 10px 0; color:#e2e8f0; font-size:18px; font-weight:700; border-bottom:2px solid #1f2937; padding-bottom:8px;">
        User Labels
      </h3>
      
      <div class="gmail-chip-grid">
        {% for label in user_labels %}
          {% set bg = (label.color.backgroundColor if label.color else '#3b82f6') %}
          {% set fg = (label.color.textColor if label.color else '#ffffff') %}
          {% set ui_visibility = label.labelListVisibility or 'n/a' %}
          {% set msg_visibility = label.messageListVisibility or 'n/a' %}
          <div class="gmail-label-chip"
               title="{{ label.name }} ‚Äî ID: {{ label.id }} ‚Ä¢ UI: {{ ui_visibility }} ‚Ä¢ List: {{ msg_visibility }}"
               aria-label="{{ label.name }} (UI {{ ui_visibility }}, List {{ msg_visibility }})"
               style="
                 background: {{ bg }};
                 background-image: linear-gradient(135deg, rgba(255,255,255,.14), rgba(0,0,0,.10));
                 color: {{ fg }};
                 border: 1px solid rgba(255,255,255,.18);
                 border-radius: 999px;
                 padding: 8px 12px;
                 margin: 4px;
                 display: inline-flex; 
                 align-items: center; 
                 gap: 8px; 
                 vertical-align: top;
                 font-size: 12px; 
                 font-weight: 600;
                 white-space: nowrap; 
                 overflow: hidden; 
                 text-overflow: ellipsis;
                 max-width: 300px;
                 box-shadow: 0 2px 8px rgba(0,0,0,.45);
                 transition: transform .2s ease;">
            <span>üìß</span>
            <span style="overflow:hidden; text-overflow:ellipsis;">{{ label.name }}</span>
            {% if label.labelListVisibility or label.messageListVisibility %}
              <span style="opacity:.9; font-size:11px; margin-left:6px;">
                {% if label.labelListVisibility %}UI:{{ label.labelListVisibility }}{% endif %}
                {% if label.messageListVisibility %} ¬∑ List:{{ label.messageListVisibility }}{% endif %}
              </span>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% endif %}

    {# ---- Section: SYSTEM LABELS ---- #}
    {% if sys_labels %}
      <h3 style="margin:28px 0 10px 0; color:#e2e8f0; font-size:18px; font-weight:700; border-bottom:2px solid #1f2937; padding-bottom:8px;">
        System Labels
      </h3>
      
      <div class="gmail-chip-grid">
        {% for label in sys_labels %}
          {% set bg = (label.color.backgroundColor if label.color else '#334155') %}
          {% set fg = (label.color.textColor if label.color else '#f8fafc') %}
          {% set ui_visibility = label.labelListVisibility or 'n/a' %}
          {% set msg_visibility = label.messageListVisibility or 'n/a' %}
          <div class="gmail-label-chip"
               title="{{ label.name }} ‚Äî ID: {{ label.id }} ‚Ä¢ UI: {{ ui_visibility }} ‚Ä¢ List: {{ msg_visibility }}"
               aria-label="{{ label.name }} (UI {{ ui_visibility }}, List {{ msg_visibility }})"
               style="
                 background: {{ bg }};
                 background-image: linear-gradient(135deg, rgba(255,255,255,.10), rgba(0,0,0,.12));
                 color: {{ fg }};
                 border: 1px solid rgba(255,255,255,.18);
                 border-radius: 999px;
                 padding: 8px 12px;
                 margin: 4px;
                 display: inline-flex; 
                 align-items: center; 
                 gap: 8px; 
                 vertical-align: top;
                 font-size: 12px; 
                 font-weight: 600;
                 white-space: nowrap; 
                 overflow: hidden; 
                 text-overflow: ellipsis;
                 max-width: 300px;
                 box-shadow: 0 2px 8px rgba(0,0,0,.45);
                 transition: transform .2s ease;">
            <span>üè∑Ô∏è</span>
            <span style="overflow:hidden; text-overflow:ellipsis;">{{ label.name }}</span>
            {% if label.labelListVisibility or label.messageListVisibility %}
              <span style="opacity:.9; font-size:11px; margin-left:6px;">
                {% if label.labelListVisibility %}UI:{{ label.labelListVisibility }}{% endif %}
                {% if label.messageListVisibility %} ¬∑ List:{{ label.messageListVisibility }}{% endif %}
              </span>
            {% endif %}
          </div>
        {% endfor %}
      </div>
    {% endif %}
  </div>
</div>

{# --- Gmail Labels Chip Grid Styles --- #}
<style>
  .gmail-chip-grid { 
    display: flex; 
    flex-wrap: wrap; 
    gap: 8px; 
    align-items: center; 
  }
  .gmail-label-chip:hover { 
    transform: translateY(-1px); 
    box-shadow: 0 6px 14px rgba(0,0,0,.55) !important; 
  }
  @media (max-width: 768px) { 
    .gmail-label-chip { 
      font-size: 11px !important; 
      padding: 6px 10px !important; 
      max-width: 250px !important; 
    } 
  }
  @media (max-width: 480px) { 
    .gmail-label-chip { 
      font-size: 10px !important; 
      padding: 5px 8px !important; 
      max-width: 200px !important; 
    } 
  }
  @media print {
    .gmail-chip-grid { gap: 4px; }
    .gmail-label-chip { 
      padding: 4px 8px !important; 
      font-size: 10px !important; 
      margin: 2px !important; 
      box-shadow: none !important; 
    }
  }
</style>
{% endmacro %}